<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.87.0">
<meta name=description content="DeltaOMS Documentation">
<meta name=author content="Himanish Kushary (Databricks)">
<link rel=icon href=https://databrickslabs.github.io/delta-oms/images/favicon.png type=image/png>
<title>Setup :: Delta Operational Metrics Store (DeltaOMS)</title>
<link href=https://databrickslabs.github.io/delta-oms/css/nucleus.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/fontawesome-all.min.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/hybrid.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/featherlight.min.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/perfect-scrollbar.min.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/auto-complete.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/atom-one-dark-reasonable.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/theme.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/tabs.css?1684599036 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/hugo-theme.css?1684599036 rel=stylesheet>
<script src=https://databrickslabs.github.io/delta-oms/js/jquery-3.3.1.min.js?1684599036></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body data-url=https://databrickslabs.github.io/delta-oms/getting_started/setup/>
<nav id=sidebar>
<div id=header-wrapper>
<div id=header>
<a id=logo href=https://databrickslabs.github.io/delta-oms/>
<img src=https://databrickslabs.github.io/delta-oms/images/DeltaOMS.png , width=85%>
</a>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/lunr.min.js?1684599036></script>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/auto-complete.js?1684599036></script>
<script type=text/javascript>var baseurl="https://databrickslabs.github.io/delta-oms/"</script>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/search.js?1684599036></script>
</div>
<section id=homelinks>
<ul>
<li>
<a class=padding href=https://databrickslabs.github.io/delta-oms/><i class="fas fa-home"></i> Home</a>
</li>
</ul>
</section>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/getting_started/ title="Getting Started" class="dd-item
parent">
<a href=https://databrickslabs.github.io/delta-oms/getting_started/>
Getting Started
</a>
<ul>
<li data-nav-id=/getting_started/prerequisites/ title=Pre-Requisites class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/prerequisites/>
Pre-Requisites
</a>
</li>
<li data-nav-id=/getting_started/setup/ title=Setup class="dd-item active">
<a href=https://databrickslabs.github.io/delta-oms/getting_started/setup/>
Setup
</a>
</li>
<li data-nav-id=/getting_started/execute/ title=Execute class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/execute/>
Execute
</a>
</li>
<li data-nav-id=/getting_started/analyze/ title=Analyze class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/analyze/>
Analyze
</a>
</li>
<li data-nav-id=/getting_started/additionalconfigurations/ title="Additional Configuration" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/additionalconfigurations/>
Additional Configuration
</a>
</li>
</ul>
</li>
<li data-nav-id=/developer_guide/ title="Developer Guide" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/>
Developer Guide
</a>
<ul>
<li data-nav-id=/developer_guide/configurationtables/ title="Configuration Tables" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/configurationtables/>
Configuration Tables
</a>
</li>
<li data-nav-id=/developer_guide/datatables/ title="Data Tables" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/datatables/>
Data Tables
</a>
</li>
<li data-nav-id=/developer_guide/datamodels/ title="Data Model" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/datamodels/>
Data Model
</a>
</li>
<li data-nav-id=/developer_guide/components/ title="Key Components" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/components/>
Key Components
</a>
</li>
</ul>
</li>
<li data-nav-id=/faq/ title="Frequently Asked Questions (FAQs)" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/>
Frequently Asked Questions (FAQs)
</a>
<ul>
<li data-nav-id=/faq/general/ title=General class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/general/>
General
</a>
</li>
<li data-nav-id=/faq/execution/ title=Execution class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/execution/>
Execution
</a>
</li>
<li data-nav-id=/faq/security/ title=Security class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/security/>
Security
</a>
</li>
</ul>
</li>
<li data-nav-id=/contributing/ title=Contributing class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/contributing/>
Contributing
</a>
</li>
</ul>
<section id=footer>
<center>
<a class=github-button href=https://github.com/databrickslabs/delta-oms/subscription data-icon=octicon-eye data-show-count=true aria-label="DeltaOMS on GitHub">Watch</a>
<a class=github-button href=https://github.com/databrickslabs/delta-oms data-icon=octicon-star data-show-count=true aria-label="Star databrickslabs/delta-oms on GitHub">Star</a>
<a class=github-button href=https://github.com/databrickslabs/delta-oms/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork DeltaOMS on GitHub">Fork</a>
<p>A <a href=https://github.com/databrickslabs>Databricks Labs</a> project.</p>
</center>
<script async defer src=https://buttons.github.io/buttons.js></script>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=https://databrickslabs.github.io/delta-oms/>Delta Operational Metrics Store (DeltaOMS)</a> > <a href=https://databrickslabs.github.io/delta-oms/getting_started/>Getting Started</a> > Setup
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#initialize-the-deltaoms-database>Initialize the DeltaOMS Database</a></li>
<li><a href=#configure-delta-lakehouse-objects-for-deltaoms-tracking>Configure Delta Lakehouse objects for DeltaOMS tracking</a></li>
<li><a href=#create-databricks-jobs>Create Databricks Jobs</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Setup
</h1>
<h3 id=initialize-the-deltaoms-database>Initialize the DeltaOMS Database</h3>
<p>DeltaOMS can be configured through multiple methods :</p>
<ul>
<li>Command line parameters - Limited to few configurations</li>
<li>Spark configurations - All configurations.Refer to <a href=https://databrickslabs.github.io/delta-oms/getting_started/additionalconfigurations//>Additional Configurations</a> section below for full details</li>
</ul>
<p>Command Line Parameters over-rides Spark Configurations.</p>
<p>For this tutorial we will use the command line parameters.More details about the other configurations can be found
under <a href=https://databrickslabs.github.io/delta-oms/getting_started/additionalconfigurations//>Additional Configurations</a> section.</p>
<p>Follow the below steps to initialize the DeltaOMS centralized Database and tables.</p>
<ul>
<li>
<p>Import and Open the DeltaOMS Setup notebook <a href=https://databrickslabs.github.io/delta-oms/assets/OMS_Setup_STEP1.scala>STEP 1</a> into
your Databricks environment</p>
</li>
<li>
<p>Modify the value of the variables <code>omsBaseLocation</code>, <code>omsDBName</code>,
<code>omsCheckpointSuffix</code>, <code>omsCheckpointBase</code> as appropriate for your environment</p>
<table>
<thead>
<tr>
<th style=text-align:center>Variable</th>
<th style=text-align:left>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>omsBaseLocation</td>
<td style=text-align:left>Base location/path of the OMS Database on the Delta Lakehouse</td>
</tr>
<tr>
<td style=text-align:center>omsDBName</td>
<td style=text-align:left>DeltaOMS Database Name. This is the centralized database with all the Delta logs</td>
</tr>
<tr>
<td style=text-align:center>omsCheckpointBase</td>
<td style=text-align:left>DeltaOMS ingestion is a streaming process.This defines the Base path for the checkpoints</td>
</tr>
<tr>
<td style=text-align:center>omsCheckpointSuffix</td>
<td style=text-align:left>Suffix to be added to the checkpoint path (Helps in making the path unique)</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Attach the DeltaOMS jar (as a library through Maven) to a running cluster</p>
<ul>
<li>Select <code>Install New</code> from the clusters <code>Libraries</code> tab
<img src=https://databrickslabs.github.io/delta-oms/images/Library_Install_New.png alt="Install New"></li>
<li>In the <code>Install Library</code> window, select <code>Maven</code> and click on <code>Search packages</code>
<img src=https://databrickslabs.github.io/delta-oms/images/Library_Install_Maven.png alt=Maven></li>
<li>Select <code>Maven Central</code> from the drop-down
<img src=https://databrickslabs.github.io/delta-oms/images/Library_Install_Maven_Central.png alt=Maven></li>
<li>Search for <code>delta-oms</code> and select the latest release version
<img src=https://databrickslabs.github.io/delta-oms/images/Library_Install_Maven_DeltaOMS.png alt=Maven></li>
<li>Finally, click <code>Install</code> to install the DeltaOMS library into the cluster</li>
</ul>
</li>
<li>
<p>Attach the imported notebook to the cluster and start executing the cells</p>
</li>
<li>
<p>Execute <code>com.databricks.labs.deltaoms.init.InitializeOMS.main</code> method to create the OMS DB and tables.</p>
</li>
<li>
<p>Validate the DeltaOMS database and tables were created (<code>Cmd 5</code> and <code>Cmd 6</code>)</p>
</li>
</ul>
<h3 id=configure-delta-lakehouse-objects-for-deltaoms-tracking>Configure Delta Lakehouse objects for DeltaOMS tracking</h3>
<p>Next, we will add few input sources (existing Delta databases or tables) to be tracked by DeltaOMS.
This is done using the same notebook.</p>
<ul>
<li>
<p>Add the names of few databases you want to track via DeltaOMS to the <code>sourceconfig</code> table in the DeltaOMD DB.
This is done by using a simple SQL <code>INSERT</code> statement:</p>
<p><code>INSERT INTO &lt;omsDBName>.sourceconfig VALUES('&lt;Database Name>',false, Map('wildCardLevel','0'))</code></p>
<p>Refer to the <a href=https://databrickslabs.github.io/delta-oms/developer_guide/>Developer Guide</a> for more details on the tables.</p>
</li>
<li>
<p>Configure the internal DeltaOMS configuration tables by executing
<code>com.databricks.labs.deltaoms.init.ConfigurePaths.main</code>.
This will populate the internal configuration table <code>pathconfig</code> with the detailed path
information for all delta tables under the database(s)</p>
</li>
</ul>
<h3 id=create-databricks-jobs>Create Databricks Jobs</h3>
<p>Next, we will create couple of databricks jobs for executing the solution. These jobs can be created manually by following the configuration options mentioned below.</p>
<h4 id=ingestion-job>Ingestion Job</h4>
<p>The first databricks job will stream ingest the delta logs from the configured delta tables and persist in the <code>rawactions</code> DeltaOMS table.
For example, you could name the job <code>OMSIngestion_Job</code>. The main configurations for the job are:</p>
<p>Main class : <code>com.databricks.labs.deltaoms.ingest.StreamPopulateOMS</code></p>
<p>Example Parameters : <code>["--dbName=oms_test_aug31","--baseLocation=dbfs:/user/hive/warehouse/oms","--checkpointBase=dbfs:/user/hive/warehouse/oms/_checkpoints","--checkpointSuffix=_aug31_171000","--skipPathConfig","--skipInitializeOMS","--startingStream=1","--endingStream=50"]</code></p>
<p><img src=https://databrickslabs.github.io/delta-oms/images/DeltaOMS_Ingestion_Job_Full.png alt="Delta OMS Streaming Ingestion Job"></p>
<h4 id=processing-job>Processing Job</h4>
<p>The second job will process the raw actions and organize them into Commit Info and Action snapshots for querying and further analytics.
You could name the job <code>OMSProcessing_Job</code>. The main configurations for the job are:</p>
<p>Main class : <code>com.databricks.labs.deltaoms.process.OMSProcessRawActions</code></p>
<p>Example Parameters : <code>["--dbName=oms_test_aug31","--baseLocation=dbfs:/user/hive/warehouse/oms"]</code></p>
<p>Example :
<img src=https://databrickslabs.github.io/delta-oms/images/DeltaOMS_Processing_Job_Full.png alt="Delta OMS Processing Job"></p>
<h4 id=example-job-creation-script>Example Job Creation Script:</h4>
<p>The ingestion job can also be created through a sample script provided as part of the solution. The steps to run the sample script are:</p>
<ul>
<li>Import and Open the DeltaOMS Setup notebook <a href=https://databrickslabs.github.io/delta-oms/assets/OMS_Setup_STEP2.py>STEP 2</a> into
your Databricks environment</li>
<li>Define the values for the <code>omsBaseLocation</code>, <code>omsDBName</code>, <code>omsCheckpointSuffix</code>, <code>omsCheckpointBase</code></li>
<li>Modify the provided Job Creation Json template and variables as appropriate to your environment.
Make sure, the correct DeltaOMS jar library (from Maven) is referred in the template</li>
<li>DeltaOMS creates individual streams for each tracked path and runs multiple such streams in a
single Databricks job. By default, it groups 50 streams into a single databricks jobs.
You could change the variable <code>num_streams_per_job</code> to change number of streams per job.</li>
<li>Once all the parameters are updated, run the command on the notebook to create the jobs.
Depending on the total number of objects tracked multiple Databricks jobs could be created</li>
<li>You can navigate to the <code>Jobs</code> UI to look at the created jobs</li>
</ul>
<p>Note: Instead of setting up two different Databricks jobs , you could also setup a single job
with multiple tasks using the <a href=https://docs.databricks.com/data-engineering/jobs/index.html>Multi-task Job</a> feature.</p>
<p>Refer to the <a href=https://databrickslabs.github.io/delta-oms/developer_guide/>Developer Guide</a> for more details on multiple stream approach
for DeltaOMS ingestion and the processing job.</p>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=https://databrickslabs.github.io/delta-oms/getting_started/prerequisites/ title=Pre-Requisites> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://databrickslabs.github.io/delta-oms/getting_started/execute/ title=Execute style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=https://databrickslabs.github.io/delta-oms/js/clipboard.min.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/perfect-scrollbar.min.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/perfect-scrollbar.jquery.min.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/jquery.sticky.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/featherlight.min.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/highlight.pack.js?1684599036></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=https://databrickslabs.github.io/delta-oms/js/modernizr.custom-3.6.0.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/learn.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/js/hugo-learn.js?1684599036></script>
<script src=https://databrickslabs.github.io/delta-oms/mermaid/mermaid.js?1684599036></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
</body>
</html>
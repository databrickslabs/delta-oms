<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.87.0">
<meta name=description content="DeltaOMS Documentation">
<meta name=author content="Himanish Kushary (Databricks)">
<link rel=icon href=https://databrickslabs.github.io/delta-oms/images/favicon.png type=image/png>
<title>Key Components :: Delta Operational Metrics Store (DeltaOMS)</title>
<link href=https://databrickslabs.github.io/delta-oms/css/nucleus.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/fontawesome-all.min.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/hybrid.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/featherlight.min.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/perfect-scrollbar.min.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/auto-complete.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/atom-one-dark-reasonable.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/theme.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/tabs.css?1630694697 rel=stylesheet>
<link href=https://databrickslabs.github.io/delta-oms/css/hugo-theme.css?1630694697 rel=stylesheet>
<script src=https://databrickslabs.github.io/delta-oms/js/jquery-3.3.1.min.js?1630694697></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body data-url=https://databrickslabs.github.io/delta-oms/developer_guide/components/>
<nav id=sidebar>
<div id=header-wrapper>
<div id=header>
<a id=logo href=https://databrickslabs.github.io/delta-oms/>
<img src=https://databrickslabs.github.io/delta-oms/images/DeltaOMS.png , width=85%>
</a>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/lunr.min.js?1630694697></script>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/auto-complete.js?1630694697></script>
<script type=text/javascript>var baseurl="https://databrickslabs.github.io/delta-oms/"</script>
<script type=text/javascript src=https://databrickslabs.github.io/delta-oms/js/search.js?1630694697></script>
</div>
<section id=homelinks>
<ul>
<li>
<a class=padding href=https://databrickslabs.github.io/delta-oms/><i class="fas fa-home"></i> Home</a>
</li>
</ul>
</section>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/getting_started/ title="Getting Started" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/>
Getting Started
</a>
<ul>
<li data-nav-id=/getting_started/prerequisites/ title=Pre-Requisites class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/prerequisites/>
Pre-Requisites
</a>
</li>
<li data-nav-id=/getting_started/setup/ title=Setup class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/setup/>
Setup
</a>
</li>
<li data-nav-id=/getting_started/execute/ title=Execute class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/execute/>
Execute
</a>
</li>
<li data-nav-id=/getting_started/analyze/ title=Analyze class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/analyze/>
Analyze
</a>
</li>
<li data-nav-id=/getting_started/additionalconfigurations/ title="Additional Configuration" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/getting_started/additionalconfigurations/>
Additional Configuration
</a>
</li>
</ul>
</li>
<li data-nav-id=/developer_guide/ title="Developer Guide" class="dd-item
parent">
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/>
Developer Guide
</a>
<ul>
<li data-nav-id=/developer_guide/configurationtables/ title="Configuration Tables" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/configurationtables/>
Configuration Tables
</a>
</li>
<li data-nav-id=/developer_guide/datatables/ title="Data Tables" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/datatables/>
Data Tables
</a>
</li>
<li data-nav-id=/developer_guide/datamodels/ title="Data Model" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/datamodels/>
Data Model
</a>
</li>
<li data-nav-id=/developer_guide/components/ title="Key Components" class="dd-item active">
<a href=https://databrickslabs.github.io/delta-oms/developer_guide/components/>
Key Components
</a>
</li>
</ul>
</li>
<li data-nav-id=/faq/ title="Frequently Asked Questions (FAQs)" class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/>
Frequently Asked Questions (FAQs)
</a>
<ul>
<li data-nav-id=/faq/general/ title=General class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/general/>
General
</a>
</li>
<li data-nav-id=/faq/execution/ title=Execution class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/execution/>
Execution
</a>
</li>
<li data-nav-id=/faq/security/ title=Security class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/faq/security/>
Security
</a>
</li>
</ul>
</li>
<li data-nav-id=/contributing/ title=Contributing class=dd-item>
<a href=https://databrickslabs.github.io/delta-oms/contributing/>
Contributing
</a>
</li>
</ul>
<section id=footer>
<center>
<a class=github-button href=https://github.com/databrickslabs/delta-oms/subscription data-icon=octicon-eye data-show-count=true aria-label="DeltaOMS on GitHub">Watch</a>
<a class=github-button href=https://github.com/databrickslabs/delta-oms data-icon=octicon-star data-show-count=true aria-label="Star databrickslabs/delta-oms on GitHub">Star</a>
<a class=github-button href=https://github.com/databrickslabs/delta-oms/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork DeltaOMS on GitHub">Fork</a>
<p>A <a href=https://github.com/databrickslabs>Databricks Labs</a> project.</p>
</center>
<script async defer src=https://buttons.github.io/buttons.js></script>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=https://databrickslabs.github.io/delta-oms/>Delta Operational Metrics Store (DeltaOMS)</a> > <a href=https://databrickslabs.github.io/delta-oms/developer_guide/>Developer Guide</a> > Key Components
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#initialization>Initialization</a></li>
<li><a href=#configuration>Configuration</a></li>
<li><a href=#ingestion>Ingestion</a></li>
<li><a href=#processing>Processing</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Key Components
</h1>
<h3 id=initialization>Initialization</h3>
<p>DeltaOMS provides the component <code>com.databricks.labs.deltaoms.init.InitializeOMS</code> for initializing<br>
the centralized OMS database. The component creates the OMS DB at the location specified by the configuration settings.
Note: This process will delete all existing data in the specified location.</p>
<table>
<thead>
<tr>
<th style=text-align:center>Configuration Key</th>
<th style=text-align:left>Command Line Argument</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>base-location</td>
<td style=text-align:left>&ndash;baseLocation=</td>
<td>Base location/path of the OMS Database on the Delta Lake</td>
<td>Y</td>
<td>dbfs:/spark-warehouse/oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>db-name</td>
<td style=text-align:left>&ndash;dbName=</td>
<td>OMS Database Name. This is the database where all the Delta log details will be collected</td>
<td>Y</td>
<td>oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>raw-action-table</td>
<td style=text-align:left>None</td>
<td>OMS table name for storing the raw delta logs collected from the configured tables</td>
<td>N</td>
<td>oms_raw_actions</td>
<td>rawactions</td>
</tr>
<tr>
<td style=text-align:center>source-config-table</td>
<td style=text-align:left>None</td>
<td>Configuration table name for setting the list of Delta Path, databases and/or tables for which the delta logs should be collected by OMS</td>
<td>N</td>
<td>oms_source_config</td>
<td>sourceconfig</td>
</tr>
<tr>
<td style=text-align:center>path-config-table</td>
<td style=text-align:left>None</td>
<td>Configuration table name for storing Delta path details and few related metadata for internal processing purposes by OMS</td>
<td>N</td>
<td>oms_path_config</td>
<td>pathconfig</td>
</tr>
<tr>
<td style=text-align:center>processed-history-table</td>
<td style=text-align:left>None</td>
<td>Configuration table name for storing processing details for OMS ETL Pipelines. Used internally by OMS</td>
<td>N</td>
<td>oms_processed_history</td>
<td>processedhistory</td>
</tr>
<tr>
<td style=text-align:center>commit-info-snapshot-table</td>
<td style=text-align:left>None</td>
<td>Table name for storing the Delta Commit Information generated from the processed raw Delta logs for configured tables/paths</td>
<td>N</td>
<td>oms_commitinfo_snapshots</td>
<td>commitinfosnapshots</td>
</tr>
<tr>
<td style=text-align:center>action-snapshot-table</td>
<td style=text-align:left>None</td>
<td>Table name for storing the Delta Actions information snapshots. Generated from processing the Raw Delta logs</td>
<td>N</td>
<td>oms_action_snapshots</td>
<td>actionsnapshots</td>
</tr>
</tbody>
</table>
<h3 id=configuration>Configuration</h3>
<p>Once DeltaOMS has been initialized, and the input sources configured <a href=#source-config>Source Config</a>,
the component provided by <code>com.databricks.labs.deltaoms.init.ConfigurePaths</code> is executed to
populate the internal <a href=#path-config>path config</a> tables. This component is also responsible for
discovering delta tables under a database or under a directory (based on how the source is configured).</p>
<table>
<thead>
<tr>
<th style=text-align:center>Configuration Key</th>
<th style=text-align:left>Command Line Argument</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>base-location</td>
<td style=text-align:left>&ndash;baseLocation=</td>
<td>Base location/path of the OMS Database on the Delta Lake</td>
<td>Y</td>
<td>dbfs:/spark-warehouse/oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>db-name</td>
<td style=text-align:left>&ndash;dbName=</td>
<td>OMS Database Name. This is the database where all the Delta log details will be collected</td>
<td>Y</td>
<td>oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>skip-initialize-oms</td>
<td style=text-align:left>&ndash;skipInitializeOMS</td>
<td>Skip initializing DeltaOMS DB</td>
<td>N</td>
<td>true</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>This component should be executed whenever there are updates to the source config table.</p>
<h3 id=ingestion>Ingestion</h3>
<p>DeltaOMS uses the delta log json files as its input. Details of the Delta Protocol Json files
can be found <a href=https://github.com/delta-io/delta/blob/master/PROTOCOL.md#file-types>here</a></p>
<p>Based on the databases, tables or individual path configured in DeltaOMS, it will fetch the
json files under the <code>_delta_log</code> folder as streams. To prevent creation of multiple streams
(applicable for large number of databases and streams) , the number of streams are optimized by
creating streams on wildcard paths instead of individual paths for table(s).</p>
<p>For example, if a tracked table has the path as
<code>dbfs:/user/hive/warehouse/sample.db/table1</code>, DeltaOMS uses the path
<code>dbfs:/user/hive/warehouse/sample.db/*/_delta_log/*.json</code> to read the Delta logs.</p>
<p>The benefits of this approach are :</p>
<ul>
<li>Automatically supports any additional table added to the database</li>
<li>No additional streams needs to be created for each additional table, making the solution more scalable</li>
</ul>
<p>For ways to configure the wildcard behaviour , refer to <a href=#source-config>Source Config</a></p>
<p>During ingestion, DeltaOMS reads the list of <code>wildcardpath</code>s from the <code>pathconfig</code> table and
creates separate read streams for each path. OMS also maintains separate checkpoint location, pool
and queryname for each stream. The Delta log json files are read, enriched with additional fields
and persisted to the <code>rawactions</code> table.</p>
<p>The ingestion process is executed from the <code>com.databricks.labs.deltaoms.ingest.StreamPopulateOMS</code>
object. By default, each streaming ingestion job can support upto 50 streams. If more than 50
streams ( for example more than 50 distinct wildcard paths) would be involved , we recommend
creating separate Databricks jobs. The <code>com.databricks.labs.deltaoms.ingest.StreamPopulateOMS</code>
supports command line parameters <code>--startingStream</code> and <code>--endingStream</code> for setting the
number of streams in each job.By default, these are set to 1 and 50 respectively.</p>
<table>
<thead>
<tr>
<th style=text-align:center>Configuration Key</th>
<th style=text-align:left>Command Line Argument</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>base-location</td>
<td style=text-align:left>&ndash;baseLocation=</td>
<td>Base location/path of the OMS Database on the Delta Lake</td>
<td>Y</td>
<td>dbfs:/spark-warehouse/oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>db-name</td>
<td style=text-align:left>&ndash;dbName=</td>
<td>OMS Database Name. This is the database where all the Delta log details will be collected</td>
<td>Y</td>
<td>oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>checkpoint-base</td>
<td style=text-align:left>&ndash;checkpointBase=</td>
<td>Base path for the checkpoints for OMS streaming pipeline for collecting the Delta logs for the configured tables</td>
<td>Y</td>
<td>dbfs:/_oms_checkpoints/</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>checkpoint-suffix</td>
<td style=text-align:left>&ndash;checkpointSuffix=</td>
<td>Suffix to be added to the checkpoint path. Useful during testing for starting off a fresh process</td>
<td>Y</td>
<td>_1234</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>trigger-interval</td>
<td style=text-align:left>None</td>
<td>Trigger interval for processing the Delta logs from the configured tables/paths</td>
<td>N</td>
<td>30s</td>
<td>Once</td>
</tr>
<tr>
<td style=text-align:center>starting-stream</td>
<td style=text-align:left>&ndash;startingStream=</td>
<td>Starting stream number for the Ingestion Job</td>
<td>N</td>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td style=text-align:center>ending-stream</td>
<td style=text-align:left>&ndash;endingStream=</td>
<td>Ending stream number for the Ingestion Job</td>
<td>N</td>
<td>30</td>
<td>50</td>
</tr>
<tr>
<td style=text-align:center>skip-path-config</td>
<td style=text-align:left>&ndash;skipPathConfig</td>
<td>Skip updating the Path Config table from the latest Source config</td>
<td>N</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td style=text-align:center>skip-initialize-oms</td>
<td style=text-align:left>&ndash;skipInitializeOMS</td>
<td>Skip initializing DeltaOMS DB</td>
<td>N</td>
<td>true</td>
<td>false</td>
</tr>
</tbody>
</table>
<h3 id=processing>Processing</h3>
<p>DeltaOMS processes the ingested data from <code>rawactions</code> and creates enriched / reconciled tables
for Commit Info and Snapshots.</p>
<p>The <code>com.databricks.labs.deltaoms.process.OMSProcessRawActions</code> object looks for the newly added
raw actions by utilizing the
<a href=https://docs.databricks.com/delta/delta-change-data-feed.html>Change Data Feed feature</a>.
The new actions are reconciled to get a list of data files conforming to
<a href=https://github.com/delta-io/delta/blob/master/PROTOCOL.md#add-file-and-remove-file>AddFile</a>
and <a href=https://github.com/delta-io/delta/blob/master/PROTOCOL.md#commit-provenance-information>CommitInfo</a>.
These are then persisted into Action Snapshots and Commit Info Snapshots respectively.</p>
<table>
<thead>
<tr>
<th style=text-align:center>Configuration Key</th>
<th style=text-align:left>Command Line Argument</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>base-location</td>
<td style=text-align:left>&ndash;baseLocation=</td>
<td>Base location/path of the OMS Database on the Delta Lake</td>
<td>Y</td>
<td>dbfs:/spark-warehouse/oms.db</td>
<td>None</td>
</tr>
<tr>
<td style=text-align:center>db-name</td>
<td style=text-align:left>&ndash;dbName=</td>
<td>OMS Database Name. This is the database where all the Delta log details will be collected</td>
<td>Y</td>
<td>oms.db</td>
<td>None</td>
</tr>
</tbody>
</table>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=https://databrickslabs.github.io/delta-oms/developer_guide/datamodels/ title="Data Model"> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://databrickslabs.github.io/delta-oms/faq/ title="Frequently Asked Questions (FAQs)" style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=https://databrickslabs.github.io/delta-oms/js/clipboard.min.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/perfect-scrollbar.min.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/perfect-scrollbar.jquery.min.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/jquery.sticky.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/featherlight.min.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/highlight.pack.js?1630694697></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=https://databrickslabs.github.io/delta-oms/js/modernizr.custom-3.6.0.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/learn.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/js/hugo-learn.js?1630694697></script>
<script src=https://databrickslabs.github.io/delta-oms/mermaid/mermaid.js?1630694697></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
</body>
</html>